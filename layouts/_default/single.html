{{/* --- シリーズナビゲーション（最強版：サイト全体から検索） --- */}}
    {{ if .Params.series }}
    <div class="mx-10 lg:mx-20 pb-20 border-t border-gray-100 dark:border-warmgray-700 pt-10">
        {{ $currentSeries := index .Params.series 0 }}
        {{/* サイト内の全ページから同じシリーズを持つものを取得し、日付順（またはweight順）に並べる */}}
        {{ $seriesPages := where .Site.RegularPages "Params.series" "intersect" .Params.series }}
        {{ $seriesPages = $seriesPages.ByDate }} {{/* 日付昇順（1話→2話） */}}

        <div class="p-6 bg-gray-50 dark:bg-warmgray-900 rounded-lg">
            <div class="mb-6 flex items-center justify-between">
                <div>
                    <span class="text-xs font-bold text-blue-500 uppercase tracking-wider">Series</span>
                    <h2 class="text-xl font-bold dark:text-white">{{ $currentSeries }}</h2>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {{/* 前の話を探す */}}
                <div class="prev-episode">
                    {{ $prev := (where $seriesPages "Date.Unix" "lt" .Date.Unix).Last }}
                    {{ with $prev }}
                        <a href="{{ .Permalink }}" class="group block p-4 rounded bg-white dark:bg-warmgray-800 shadow-sm hover:shadow-md transition-all">
                            <span class="text-xs text-gray-400 block mb-1">← 前のお話</span>
                            <div class="text-sm font-bold dark:text-gray-200 group-hover:text-blue-500 truncate">{{ .Title }}</div>
                        </a>
                    {{ else }}
                        <div class="p-4 opacity-30 text-xs border border-dashed border-gray-300 rounded text-center italic">最初のエピソード</div>
                    {{ end }}
                </div>

                {{/* 次の話を探す */}}
                <div class="next-episode text-right">
                    {{ $next := (where $seriesPages "Date.Unix" "gt" .Date.Unix).First }}
                    {{ with $next }}
                        <a href="{{ .Permalink }}" class="group block p-4 rounded bg-white dark:bg-warmgray-800 shadow-sm hover:shadow-md transition-all">
                            <span class="text-xs text-gray-400 block mb-1">次のお話 →</span>
                            <div class="text-sm font-bold dark:text-gray-200 group-hover:text-blue-500 truncate">{{ .Title }}</div>
                        </a>
                    {{ else }}
                        <div class="p-4 opacity-30 text-xs border border-dashed border-gray-300 rounded text-center italic">最新のエピソード</div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
    {{ else }}
    <div class="pb-28"></div>
    {{ end }}